  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install mystmd
        run: pip install mystmd

      - name: Set BASE_URL (repo-relative)
        run: echo "BASE_URL=/${{ github.event.repository.name }}" >> $GITHUB_ENV

      - name: Build MyST site
        run: myst build --html --base-url "$BASE_URL"

      - name: List built files (sanity check)
        run: |
          echo "Top level of _build/site:"
          ls -la _build/site

      - name: Upload site artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: _build/site
